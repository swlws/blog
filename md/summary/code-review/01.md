---
title: 重构, 改善既有代码设计 - 第二版
URL: https://book-refactoring2.ifmicro.com/docs/
---

# 概念

Q1：什么是重构？

A1：重构（refactoring）是这样一个过程：在不改变代码外在行为的前提下，对代码做出修改，以改进程序的内部结构。

Q2：重构是一次性的吗？

A1：重构是多次重复的过程，在代码写好之后改进它的设计

Q3：重构的好处

A4：前期不断的重构，降低后续出错的概率

Q5：什么因素导致需要重构？

A5：需求的变化，导致需要重构。若是代码永远不会被修改，则不需要重构他

# 重构第一步

什么是好代码？

好代码的检验标准就是人们是否能轻而易举地修改它，有人需要修改代码时，他们应能轻易找到修改点，应该能快速做出更改，而不易引入其他错误

技巧：

一个 for 循环，和两个同级的 for 循环，大多数情况下，性能消耗类似，差距可以忽略不计。

思考：

1. 开始重构后，每一步修改后，都要记得跑一次测试用例，确定每一步的修改都是正确的。
   - 即小步修改，每次修改后就运行测试。
   - 避免修改太多，陷入测试的麻烦。
2. 变量命名。
   - 语义化
   - 优美，避免太长
   - 不能太通用，比如：format、make、readFile。尽量与业务、功能有关联性
3. 如果重构引入了性能损耗，先完成重构，再做性能优化。

# 重构的要素

1. 小步修改，步步校验
2. 重构与性能优化的区别。前者为了代码更易读、更易维护；后者让程序运行的更快、占用资源更少。
3. 重构时仅重构；添加功能时，仅添加功能。两件事可以交叉做，但不要同时做。
4. 经常性的重构有助于代码维持自己该有的形态。
5. 代码量减少并不会使系统运行更快，因为这对程序的资源占用几乎没有任何明显影响。然而代码量减少将使未来可能的程序修改动作容易得多。
6. 重构能够帮助我更有效地写出健壮的代码。
7. 长远的看，重构帮我更快速地开发程序。
8. 重构的最佳时机就在添加新功能之前。
9. 添加新功能最快的方法往往是先修改现有的代码，使新功能容易被加入
10. 何时不应该重构。只有当需要理解其工作原理时，对其进行重构才有价值。

# 第 8 章 搬移特性

大的原则：

- 搬移语句到函数
- 搬移语句到调用者
- 移除死低代码，即永远不会用的代码
- 拆分循环，每个循环仅做一件事情，以管道取代循环

1. 搬移函数：保持函数的简单、单纯
   - 根据上下文环境，搬移函数到正确的上下文中
   - 优先搬移变量，根据变量的操作行为再搬移函数
2. 搬移字段：构造良好的数据结构，坏的数据结构会掩藏程序的真实意图
   - 数据结构需要不断的迭代，今天合理的数据结构，明天就不一定合理了
   - 当修改一个数据结构的某个字段时，需要同时修改其它数据结构中的字段时，考虑搬移字段
3. 搬移语句到函数
   - 将类似的行为搬移到同一个函数里
4. 搬移语句到调用者
   - 行为不一致时，将部分语句搬移出函数

**备注**

- 2 与 3 互为反模式
